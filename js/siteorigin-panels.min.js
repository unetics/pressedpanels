/**
 * Everything we need for SiteOrigin Page Builder.
 *
 * @copyright Greg Priday 2013 - 2014 - <https://siteorigin.com/>
 * @license GPL 3.0 http://www.gnu.org/licenses/gpl.html
 */
String.prototype.panelsProcessTemplate=function(){var e=this;return e=e.replace(/{{%/g,"<%"),e=e.replace(/%}}/g,"%>"),e=e.trim()},function($,e,t){var i={model:{},collection:{},view:{},dialog:{},fn:{}};i.model.widget=Backbone.Model.extend({cell:null,defaults:{"class":null,missing:!1,values:{},raw:!1,styles:{}},getWidgetField:function(e){return"undefined"==typeof t.widgets[this.get("class")]?"title"===e||"description"===e?t.loc.missing_widget[e]:"":t.widgets[this.get("class")][e]},moveToCell:function(e){return this.cell.cid===e.cid?!1:(this.cell=e,this.collection.remove(this,{silent:!0}),void e.widgets.add(this,{silent:!0}))},triggerEdit:function(){this.trigger("user_edit",this)},triggerDuplicate:function(){this.trigger("user_duplicate",this)},setValues:function(e){var t=!1;JSON.stringify(e)!==JSON.stringify(this.get("values"))&&(t=!0),this.set("values",e,{silent:!0}),t&&(this.trigger("change"),this.trigger("change:values"))},clone:function(e,t){"undefined"==typeof e&&(e=this.cell);var i=new this.constructor(this.attributes),s=JSON.parse(JSON.stringify(this.get("values")));return"SiteOrigin_Panels_Widgets_Layout"===this.get("class")&&(s.builder_id=Math.random().toString(36).substr(2)),i.set("values",s,{silent:!0}),i.set("collection",e.widgets,{silent:!0}),i.cell=e,i.isDuplicate=!0,i},getTitle:function(){var i=t.widgets[this.get("class")];if("undefined"!=typeof i.panels_title&&i.panels_title===!1)return t.widgets[this.get("class")].description;var s=this.get("values"),l=this,o=["title","text"];for(var n in s)o.push(n);o=e.uniq(o);for(var a in o)if("undefined"!=typeof s[o[a]]&&"string"==typeof s[o[a]]&&""!==s[o[a]]&&!$.isNumeric(s[o[a]])){var r=s[o[a]];r=r.replace(/<\/?[^>]+(>|$)/g,"");var d=r.split(" ");return d=d.slice(0,20),d.join(" ")}return this.getWidgetField("description")}}),i.view.widget=Backbone.View.extend({template:e.template($("#siteorigin-panels-builder-widget").html().panelsProcessTemplate()),cell:null,dialog:null,events:{"click .widget-edit":"editHandler","click .title h4":"editHandler","click .actions .widget-duplicate":"duplicateHandler","click .actions .widget-delete":"deleteHandler"},initialize:function(){this.model.on("user_edit",this.editHandler,this),this.model.on("user_duplicate",this.duplicateHandler,this),this.model.on("destroy",this.onModelDestroy,this),this.model.on("visual_destroy",this.visualDestroyModel,this),this.model.on("change:values",this.onModelChange,this)},render:function(t){if(t=e.extend({loadForm:!1},t),this.setElement(this.template({title:this.model.getWidgetField("title"),description:this.model.getTitle()})),this.$el.data("view",this),0===e.size(this.model.get("values"))||t.loadForm){var i=this.getEditDialog();i.once("form_loaded",i.saveWidget,i),i.setupDialog()}},visualCreate:function(){this.$el.hide().fadeIn("fast")},getEditDialog:function(){return null===this.dialog&&(this.dialog=new i.dialog.widget({model:this.model}),this.dialog.setBuilder(this.cell.row.builder),this.dialog.widgetView=this),this.dialog},editHandler:function(){return this.getEditDialog().openDialog(),!1},duplicateHandler:function(){this.cell.row.builder.addHistoryEntry("widget_duplicated");var e=this.model.clone(this.model.cell);return this.cell.model.widgets.add(e,{at:this.model.collection.indexOf(this.model)+1}),!1},deleteHandler:function(){return this.model.trigger("visual_destroy"),!1},onModelChange:function(){this.$(".description").html(this.model.getTitle())},onModelDestroy:function(){this.remove()},visualDestroyModel:function(){this.cell.row.builder.addHistoryEntry("widget_deleted");var e=this;this.$el.fadeOut("fast",function(){e.cell.row.resize(),e.model.destroy()})}}),i.collection.widgets=Backbone.Collection.extend({model:i.model.widget,initialize:function(){}}),i.model.cell=Backbone.Model.extend({widgets:{},row:null,defaults:{weight:0},initialize:function(){this.widgets=new i.collection.widgets,this.on("destroy",this.onDestroy,this)},onDestroy:function(){e.invoke(this.widgets.toArray(),"destroy"),this.widgets.reset()},clone:function(t,i){"undefined"==typeof t&&(t=this.row),i=e.extend({cloneWidgets:!0},i);var s=new this.constructor(this.attributes);return s.set("collection",t.cells,{silent:!0}),s.row=t,i.cloneWidgets&&this.widgets.each(function(e){s.widgets.add(e.clone(s,i),{silent:!0})}),s}}),i.collection.cells=Backbone.Collection.extend({model:i.cell,initialize:function(){this.on("add",this.onAddCell,this)},totalWeight:function(){var e=0;return this.each(function(t){e+=t.get("weight")}),e}}),i.view.cell=Backbone.View.extend({template:e.template($("#siteorigin-panels-builder-cell").html().panelsProcessTemplate()),events:{"click .cell-wrapper":"handleCellClick","click .so-cell-actions a":"handleActionClick"},row:null,widgetSortable:null,initialize:function(){this.model.widgets.on("add",this.onAddWidget,this)},render:function(){var e={weight:this.model.get("weight"),totalWeight:this.row.model.cells.totalWeight()};this.setElement(this.template(e)),this.$el.data("view",this);var t=this;this.model.widgets.each(function(e){var s=new i.view.widget({model:e});s.cell=t,s.render(),s.$el.appendTo(t.$(".widgets-container"))}),this.initSortable(),this.initResizable()},initSortable:function(){var e=this,t=e.row.builder.$el.attr("id");this.widgetSortable=this.$el.find(".widgets-container").sortable({placeholder:"so-widget-sortable-highlight",connectWith:"#"+t+" .so-cells .cell .widgets-container",tolerance:"pointer",scroll:!1,over:function(t,i){e.row.builder.trigger("widget_sortable_move")},stop:function(t,i){e.row.builder.addHistoryEntry("widget_moved");var s=$(i.item).data("view"),l=$(i.item).closest(".cell").data("view");s.model.moveToCell(l.model),s.cell=l,e.row.builder.sortCollections()},helper:function(e,t){var i=t.clone().css({width:t.outerWidth(),"z-index":1e4,position:"fixed"}).addClass("widget-being-dragged").appendTo("body");return t.outerWidth()>720&&i.animate({"margin-left":e.pageX-t.offset().left-240,width:480},"fast"),i}})},refreshSortable:function(){this.widgetSortable.sortable("refresh")},initResizable:function(){var e=this.$(".resize-handle").css("position","absolute"),t=this.row.$el,i=this,s;e.draggable({axis:"x",containment:t,start:function(e,t){if(s=i.$el.prev().data("view"),"undefined"==typeof s)return!1;var l=i.$el.clone().appendTo(t.helper).css({position:"absolute",top:"0",width:i.$el.outerWidth(),left:5,height:i.$el.outerHeight()});l.find(".resize-handle").remove();var o=s.$el.clone().appendTo(t.helper).css({position:"absolute",top:"0",width:s.$el.outerWidth(),right:5,height:s.$el.outerHeight()});o.find(".resize-handle").remove(),$(this).data({newCellClone:l,prevCellClone:o})},drag:function(t,l){var o=i.row.$el.width()+10,n=i.model.get("weight")-(l.position.left+e.outerWidth()/2)/o,a=s.model.get("weight")+(l.position.left+e.outerWidth()/2)/o;$(this).data("newCellClone").css("width",o*n).find(".preview-cell-weight").html(Math.round(1e3*n)/10),$(this).data("prevCellClone").css("width",o*a).find(".preview-cell-weight").html(Math.round(1e3*a)/10)},stop:function(t,l){$(this).data("newCellClone").remove(),$(this).data("prevCellClone").remove();var o=i.row.$el.width()+10,n=i.model.get("weight")-(l.position.left+e.outerWidth()/2)/o,a=s.model.get("weight")+(l.position.left+e.outerWidth()/2)/o;n>.02&&a>.02&&(i.row.builder.addHistoryEntry("cell_resized"),i.model.set("weight",n),s.model.set("weight",a),i.row.resize()),l.helper.css("left",-e.outerWidth()/2)}})},onAddWidget:function(t,s,l){l=e.extend({noAnimate:!1},l);var o=new i.view.widget({model:t});o.cell=this,"undefined"==typeof t.isDuplicate&&(t.isDuplicate=!1),o.render({loadForm:t.isDuplicate}),"undefined"==typeof l.at||s.length<=1?o.$el.appendTo(this.$(".widgets-container")):o.$el.insertAfter(this.$(".widgets-container .so-widget").eq(l.at-1)),l.noAnimate===!1&&o.visualCreate(),this.refreshSortable(),this.row.resize()},handleActionClick:function(e){return!1}}),i.model.row=Backbone.Model.extend({cells:{},builder:null,defaults:{style:{}},initialize:function(){this.cells=new i.collection.cells,this.on("destroy",this.onDestroy,this)},setCells:function(t){var s=this;if(0===this.cells.length)e.each(t,function(e){var t=new i.model.cell({weight:e,collection:s.cells});t.row=s,s.cells.add(t)});else{if(t.length>this.cells.length)for(var l=this.cells.length;l<t.length;l++){var o=new i.model.cell({weight:t[t.length+l],collection:s.cells});o.row=this,s.cells.add(o)}else t.length<this.cells.length&&e.each(this.cells.slice(t.length,this.cells.length),function(e){e.destroy()});this.cells.each(function(e,i){e.set("weight",t[i])})}this.reweightCells()},reweightCells:function(){var e=0;this.cells.each(function(t){e+=t.get("weight")}),this.cells.each(function(t){t.set("weight",t.get("weight")/e)}),this.trigger("reweight_cells")},onDestroy:function(){e.invoke(this.cells.toArray(),"destroy"),this.cells.reset()},clone:function(t,i){"undefined"==typeof t&&(t=this.builder),i=e.extend({cloneCells:!0},i);var s=new this.constructor(this.attributes);return s.set("collection",t.rows,{silent:!0}),s.builder=t,i.cloneCells&&this.cells.each(function(e){s.cells.add(e.clone(s,i),{silent:!0})}),s}}),i.collection.rows=Backbone.Collection.extend({model:i.model.row,empty:function(){for(var e;;){if(e=this.collection.first(),!e)break;e.destroy()}}}),i.view.row=Backbone.View.extend({template:e.template($("#siteorigin-panels-builder-row").html().panelsProcessTemplate()),events:{"click .so-row-settings":"editSettingsHandler","click .so-row-duplicate":"duplicateHandler","click .so-row-delete":"confirmedDeleteHandler"},builder:null,dialog:null,initialize:function(){this.model.cells.on("add",this.handleCellAdd,this),this.model.cells.on("remove",this.handleCellRemove,this),this.model.on("reweight_cells",this.resize,this),this.model.on("destroy",this.onModelDestroy,this),this.model.on("visual_destroy",this.visualDestroyModel,this);var e=this;this.model.cells.each(function(t){e.listenTo(t.widgets,"add",e.resize)}),this.model.cells.on("add",function(t){e.listenTo(t.widgets,"add",e.resize)},this)},render:function(){this.setElement(this.template()),this.$el.data("view",this);var e=this;return this.model.cells.each(function(t){var s=new i.view.cell({model:t});s.row=e,s.render(),s.$el.appendTo(e.$(".so-cells"))}),this.builder.on("widget_sortable_move",this.resize,this),this.builder.on("builder_resize",this.resize,this),this.resize(),this},visualCreate:function(){this.$el.hide().fadeIn("fast")},resize:function(e){if(!this.$el.is(":visible"))return!1;this.$el.find(".so-cells .cell-wrapper").css("min-height",0);var t=0;this.$el.find(".so-cells .cell").each(function(){t=Math.max(t,$(this).height()),$(this).css("width",100*$(this).data("view").model.get("weight")+"%")}),this.$el.find(".so-cells .cell-wrapper").css("min-height",Math.max(t,70))},onModelDestroy:function(){this.remove()},visualDestroyModel:function(){this.builder.addHistoryEntry("row_deleted");var e=this;this.$el.fadeOut("normal",function(){e.model.destroy(),e.builder.model.refreshPanelsData(),e.builder.liveEditor.displayed&&e.builder.liveEditor.refreshWidgets()})},duplicateHandler:function(){this.builder.addHistoryEntry("row_duplicated");var e=this.model.clone(this.builder.model);return this.builder.model.rows.add(e,{at:this.builder.model.rows.indexOf(this.model)+1}),!1},confirmedDeleteHandler:function(e){var i=$(e.target);if(i.hasClass("dashicons")&&(i=i.parent()),i.hasClass("so-confirmed"))this.visualDestroyModel();else{var s=i.html();i.addClass("so-confirmed").html('<span class="dashicons dashicons-yes"></span>'+t.loc.dropdown_confirm),setTimeout(function(){i.removeClass("so-confirmed").html(s)},2500)}return!1},editSettingsHandler:function(){var e=this.builder.dialogs.row;return null==this.dialog&&(this.dialog=new i.dialog.row,this.dialog.setBuilder(this.builder).setRowModel(this.model)),this.dialog.openDialog(),!1},deleteHandler:function(){return this.model.destroy(),!1},handleCellAdd:function(e){var t=new i.view.cell({model:e});t.row=this,t.render(),t.$el.appendTo(this.$(".so-cells"))},handleCellRemove:function(e){this.$el.find(".so-cells > .cell").each(function(){var t=$(this).data("view");return"undefined"==typeof t?!1:void(t.model.cid===e.cid&&t.remove())})}}),i.model.builder=Backbone.Model.extend({rows:{},defaults:{data:{widgets:[],grids:[],grid_cells:[]}},initialize:function(){this.rows=new i.collection.rows},addRow:function(t,s){s=e.extend({noAnimate:!1},s);var l=new i.model.row({collection:this.rows});return l.setCells(t),l.builder=this,this.rows.add(l,s),l},loadPanelsData:function(t){this.emptyRows(),this.set("data",t,{silent:!0});var s=0,l=[];if("undefined"!=typeof t.grid_cells){for(var o,n=0;n<t.grid_cells.length;n++)o=parseInt(t.grid_cells[n].grid),"undefined"==typeof l[o]&&(l[o]=[]),l[o].push(parseFloat(t.grid_cells[n].weight));var a=this;e.each(l,function(e,i){var s=a.addRow(e,{noAnimate:!0});"undefined"!=typeof t.grids[i].style&&s.set("style",t.grids[i].style)}),"undefined"!=typeof t.widgets&&e.each(t.widgets,function(e){try{var t=null;"undefined"!=typeof e.panels_info?(t=e.panels_info,delete e.panels_info):(t=e.info,delete e.info);var s=a.rows.at(parseInt(t.grid)),l=s.cells.at(parseInt(t.cell)),o=new i.model.widget({"class":t.class,values:e});"undefined"!=typeof t.style&&o.set("style",t.style),o.cell=l,l.widgets.add(o,{noAnimate:!0})}catch(n){}})}},getPanelsData:function(){var t={widgets:[],grids:[],grid_cells:[]},i=0;return this.rows.each(function(s,l){s.cells.each(function(s,o){s.widgets.each(function(s,n){var a=e.extend(e.clone(s.get("values")),{panels_info:{"class":s.get("class"),raw:s.get("raw"),grid:l,cell:o,id:i++,style:s.get("style")}});t.widgets.push(a)}),t.grid_cells.push({grid:l,weight:s.get("weight")})}),t.grids.push({cells:s.cells.length,style:s.get("style")})}),t},refreshPanelsData:function(){var e=JSON.stringify(this.get("data")),t=this.getPanelsData();this.set("data",t,{silent:!0}),JSON.stringify(t)!==e&&(this.trigger("change"),this.trigger("change:data"))},emptyRows:function(){return e.invoke(this.rows.toArray(),"destroy"),this.rows.reset(),this}}),i.view.builder=Backbone.View.extend({template:e.template($("#siteorigin-panels-builder").html().panelsProcessTemplate()),dialogs:{},rowsSortable:null,dataField:!1,currentData:"",attachedToEditor:!1,liveEditor:!1,events:{"click .so-tool-button.so-widget-add":"displayAddWidgetDialog","click .so-tool-button.so-row-add":"displayAddRowDialog","click .so-tool-button.so-prebuilt-add":"displayAddPrebuiltDialog","click .so-tool-button.so-history":"displayHistoryDialog","click .so-tool-button.so-live-editor":"displayLiveEditor","click .so-cells .cell .cell-wrapper":"cellClickHandler"},rows:null,initialize:function(){var t=this;this.dialogs={widgets:new i.dialog.widgets,row:new i.dialog.row,prebuilt:new i.dialog.prebuilt},e.each(this.dialogs,function(e,i,s){s[i].setBuilder(t)}),this.dialogs.row.setRowDialogType("create"),this.model.rows.on("add",this.onAddRow,this),$(window).resize(function(e){e.target===window&&t.trigger("builder_resize")}),this.model.on("change:data",this.storeModelData,this),this.on("content_change",this.handleContentChange,this),this.on("display_builder",this.handleDisplayBuilder,this),this.model.on("change:data",this.toggleWelcomeDisplay,this)},render:function(){return this.$el.html(this.template()),this.$el.attr("id","siteorigin-panels-builder-"+this.cid).addClass("so-builder-container"),this},attach:function(t){return t=e.extend({container:!1,dialog:!1},t),t.dialog?(this.dialog=new i.dialog.builder,this.dialog.builder=this):(this.$el.appendTo(t.container),this.metabox=t.container.closest(".postbox"),this.initSortable()),this},attachToEditor:function(){if("undefined"==typeof this.metabox)return this;this.attachedToEditor=!0;var t=this.metabox,i=this;$("#wp-content-wrap .wp-editor-tabs").find(".wp-switch-editor").click(function(e){e.preventDefault(),$("#wp-content-editor-container, #post-status-info").show(),t.hide(),$("#wp-content-wrap").removeClass("panels-active"),$("#content-resize-handle").show(),i.trigger("hide_builder")}).end().prepend($('<a id="content-panels" class="hide-if-no-js wp-switch-editor switch-panels">'+t.find("h3.hndle span").html()+"</a>").click(function(e){e.preventDefault();var s=$(this);$("#wp-content-wrap, #post-status-info").hide(),t.show().find("> .inside").show(),$(window).resize(),$(document).scroll(),i.trigger("display_builder")})),($("body").hasClass("branch-4-1")||$("body").hasClass("branch-4-2"))&&$("#wp-content-wrap .wp-editor-tabs #content-panels").appendTo($("#wp-content-wrap .wp-editor-tabs")),t.find(".so-switch-to-standard").click(function(e){e.preventDefault(),$("#wp-content-wrap, #post-status-info").show(),t.hide(),$(window).resize()}).show(),t.insertAfter("#wp-content-wrap").hide().addClass("attached-to-editor");var s=this.model.get("data");"undefined"!=typeof s.widgets&&0!==e.size(s.widgets)&&$("#content-panels.switch-panels").click();var l=function(){var e=i.$(".so-builder-toolbar"),t=$(window).scrollTop()-i.$el.offset().top;"fixed"===$("#wpadminbar").css("position")&&(t+=$("#wpadminbar").outerHeight()),t=Math.max(t,0),t=Math.min(t,i.$el.outerHeight()-e.outerHeight()+20),e.css("top",t),i.$el.css("padding-top",e.outerHeight())};return $(window).resize(l),$(document).scroll(l),l(),this},initSortable:function(){var e=this.$el,t=this;this.rowsSortable=this.$el.find(".so-rows-container").sortable({appendTo:"#wpwrap",items:".so-row-container",handle:".so-row-move",tolerance:"pointer",scroll:!1,stop:function(e){t.addHistoryEntry("row_moved"),t.sortCollections()}})},refreshSortable:function(){null!==this.rowsSortable&&this.rowsSortable.sortable("refresh")},setDataField:function(t,i){if(i=e.extend({load:!0},i),this.dataField=t,this.dataField.data("builder",this),i.load&&""!==t.val()){var s;try{s=JSON.parse(this.dataField.val())}catch(l){s=""}this.model.loadPanelsData(s),this.currentData=s,this.toggleWelcomeDisplay()}return this},storeModelData:function(){var e=JSON.stringify(this.model.get("data"));$(this.dataField).val()!==e&&($(this.dataField).val(e),this.trigger("content_change"))},onAddRow:function(t,s,l){l=e.extend({noAnimate:!1},l);var o=new i.view.row({model:t});o.builder=this,o.render(),"undefined"==typeof l.at||s.length<=1?o.$el.appendTo(this.$(".so-rows-container")):o.$el.insertAfter(this.$(".so-rows-container .so-row-container").eq(l.at-1)),l.noAnimate===!1&&o.visualCreate(),this.refreshSortable(),o.resize()},displayAddWidgetDialog:function(){return this.dialogs.widgets.openDialog(),!1},displayAddRowDialog:function(){return this.dialogs.row.openDialog(),this.dialogs.row.setRowModel(),!1},displayAddPrebuiltDialog:function(){return this.dialogs.prebuilt.openDialog(),!1},displayHistoryDialog:function(){return this.dialogs.history.openDialog(),!1},cellClickHandler:function(e){var t=this.$el.find(".so-cells .cell").removeClass("cell-selected");$(e.target).parent().addClass("cell-selected")},getActiveCell:function(){0===this.$(".so-cells .cell").length&&this.model.addRow([1],{noAnimate:!0});var e=this.$(".so-cells .cell.cell-selected");return e.length||(e=this.$(".so-cells .cell").first()),e.data("view").model},sortCollections:function(){var e={};this.$(".so-rows-container .so-row-container").each(function(t,i){var s=$(i);e[s.data("view").model.cid]=t,s.find(".so-cells .cell").each(function(t,i){var s=$(i);s.find(".so-widget").each(function(t,i){var s=$(i);e[s.data("view").model.cid]=t})})}),this.model.rows.models=this.model.rows.sortBy(function(t){return e[t.cid]}),this.model.rows.each(function(t){t.cells.each(function(t){t.widgets.models=t.widgets.sortBy(function(t){return e[t.cid]})})}),this.model.refreshPanelsData()},addLiveEditor:function(e){return"undefined"==typeof i.view.liveEditor?this:(this.liveEditor=new i.view.liveEditor,this.liveEditor.setPostId(e),this.liveEditor.builder=this,this.liveEditor.hasPreviewUrl()&&this.$(".so-builder-toolbar .so-live-editor").show(),this)},displayLiveEditor:function(){return"undefined"==typeof this.liveEditor?!1:(this.liveEditor.open(),!1)},addHistoryBrowser:function(){return"undefined"==typeof i.dialog.history?this:(this.dialogs.history=new i.dialog.history,this.dialogs.history.builder=this,this.dialogs.history.entries.builder=this.model,this.dialogs.history.setRevertEntry(this.model),void this.$(".so-builder-toolbar .so-history").show())},addHistoryEntry:function(e,t){"undefined"==typeof t&&(t=null),"undefined"!=typeof this.dialogs.history&&this.dialogs.history.entries.addEntry(e,t)},handleContentChange:function(){this.attachedToEditor&&this.$el.is(":visible")&&this.model.rows.length>0&&$.post(ajaxurl,{action:"so_panels_builder_content",panels_data:JSON.stringify(this.model.getPanelsData()),post_id:$("#post_ID").val()},function(e){if(""!==e){var t=$("<div />").html(e);t.find("div").each(function(){var e=$(this).contents();$(this).replaceWith(e)}),e=t.html(),"undefined"==typeof tinyMCE||null===tinyMCE.get("content")?$("#content").val(e):tinyMCE.get("content").setContent(e),$("#content").focusout()}}),this.liveEditor!==!1&&this.liveEditor.refreshPreview()},handleDisplayBuilder:function(){var i="",s;if("undefined"!=typeof tinyMCE&&(s=tinyMCE.get("content")),i=null!==s&&"function"==typeof s.getContent?s.getContent():$("textarea#content").val(),e.isEmpty(this.model.get("data"))&&""!==i){if(!confirm(t.loc.confirm_use_builder))return;var l="";if("undefined"!=typeof t.widgets.WP_Widget_Black_Studio_TinyMCE?l="WP_Widget_Black_Studio_TinyMCE":"undefined"!=typeof t.widgets.WP_Widget_Text&&(l="WP_Widget_Text"),""===l)return;this.model.loadPanelsData({grid_cells:[{grid:0,weight:1}],grids:[{cells:1}],widgets:[{filter:"1",text:i,title:"",type:"visual",panels_info:{"class":l,raw:!1,grid:0,cell:0}}]}),this.model.trigger("change"),this.model.trigger("change:data")}},setDialogParents:function(t,i){e.each(this.dialogs,function(e,s,l){l[s].setParent(t,i)}),this.on("add_dialog",function(e){e.setParent(t,i)},this)},toggleWelcomeDisplay:function(){this.model.rows.length?this.$(".so-panels-welcome-message").hide():this.$(".so-panels-welcome-message").show()}}),i.view.dialog=Backbone.View.extend({dialogTemplate:e.template($("#siteorigin-panels-dialog").html().panelsProcessTemplate()),dialogTabTemplate:e.template($("#siteorigin-panels-dialog-tab").html().panelsProcessTemplate()),tabbed:!1,rendered:!1,builder:!1,className:"so-panels-dialog-wrapper",dialogClass:"",parentDialog:!1,events:{"click .so-close":"closeDialog","click .so-nav.so-previous":"navToPrevious","click .so-nav.so-next":"navToNext"},initialize:function(){this.once("open_dialog",this.render),this.once("open_dialog",this.attach),this.once("open_dialog",this.setDialogClass),this.trigger("initialize_dialog",this),"undefined"!=typeof this.initializeDialog&&this.initializeDialog()},getNextDialog:function(){return null},getPrevDialog:function(){return null},setDialogClass:function(){""!==this.dialogClass&&this.$(".so-panels-dialog").addClass(this.dialogClass)},setBuilder:function(e){return this.builder=e,e.trigger("add_dialog",this,this.builder),this},attach:function(){return this.$el.appendTo("body"),this},parseDialogContent:function(t,i){i=e.extend({cid:this.cid},i);var s=$(e.template(t.panelsProcessTemplate())(i)),l={title:s.find(".title").html(),buttons:s.find(".buttons").html(),content:s.find(".content").html()};return s.has(".left-sidebar")&&(l.left_sidebar=s.find(".left-sidebar").html()),s.has(".right-sidebar")&&(l.right_sidebar=s.find(".right-sidebar").html()),l},renderDialog:function(e){if(this.$el.html(this.dialogTemplate(e)).hide(),this.$el.data("view",this),this.$el.addClass("so-panels-dialog-wrapper"),this.parentDialog!==!1){var t=this,i=$('<h3 class="so-parent-link"></h3>').html(this.parentDialog.text+'<div class="so-separator"></div>');i.click(function(e){e.preventDefault(),t.closeDialog(),t.parentDialog.openDialog()}),this.$(".so-title-bar").prepend(i)}return this},initTabs:function(){var e=this.$el.find(".so-sidebar-tabs li a");if(0===e.length)return this;var t=this;return e.click(function(e){e.preventDefault();var i=$(this);t.$(".so-sidebar-tabs li").removeClass("tab-active"),t.$(".so-content .so-content-tabs > *").hide(),i.parent().addClass("tab-active");var s=i.attr("href");if("undefined"!=typeof s&&"#"===s.charAt(0)){var l=s.split("#")[1];t.$(".so-content .so-content-tabs .tab-"+l).show()}t.trigger("tab_click",i)}),this.$el.find(".so-sidebar-tabs li a").first().click(),this},setupDialog:function(){this.openDialog(),this.closeDialog()},refreshDialogNav:function(){this.$(".so-title-bar .so-nav").show().removeClass("so-disabled");var e=this.getNextDialog(),t=this.$(".so-title-bar .so-next"),i=this.getPrevDialog(),s=this.$(".so-title-bar .so-previous");null===e?t.hide():e===!1&&t.addClass("so-disabled"),null===i?s.hide():i===!1&&s.addClass("so-disabled")},openDialog:function(){this.trigger("open_dialog"),this.refreshDialogNav(),this.bodyScrollTop=$("body").scrollTop(),$("body").css({overflow:"hidden"}),this.$el.show(),this.trigger("open_dialog_complete")},closeDialog:function(e){return this.trigger("close_dialog"),"undefined"!=typeof this.builder&&this.builder.model.refreshPanelsData(),this.$el.hide(),$(".so-panels-dialog-wrapper").is(":visible")||($("body").css({overflow:"auto"}),$("body").scrollTop(this.bodyScrollTop)),this.trigger("close_dialog_complete"),!1},navToPrevious:function(){this.closeDialog(null);var e=this.getPrevDialog();null!==e&&e!==!1&&e.openDialog()},navToNext:function(){this.closeDialog(null);var e=this.getNextDialog();null!==e&&e!==!1&&e.openDialog()},getFormValues:function(t){"undefined"==typeof t&&(t=".so-content");var i=this.$(t),s={},l;return i.find("[name]").each(function(){var t=$(this),i=/([A-Za-z_]+)\[(.*)\]/.exec(t.attr("name"));"undefined"==typeof i[2]?l=t.attr("name"):(l=i[2].split("]["),l.unshift(i[1])),l=l.map(function(e){return!isNaN(parseFloat(e))&&isFinite(e)?parseInt(e):e});var o=s,n=null,a="string"==typeof t.attr("type")?t.attr("type").toLowerCase():!1;if("checkbox"===a)n=t.is(":checked")?""!==t.val()?t.val():!0:null;else if("radio"===a){if(!t.is(":checked"))return;n=t.val()}else if("TEXTAREA"===t.prop("tagName")&&t.hasClass("wp-editor-area")){var r=null;"undefined"!=typeof tinyMCE&&(r=tinyMCE.get(t.attr("id"))),n=null!==r&&"function"==typeof r.getContent?r.getContent():t.val()}else if("SELECT"===t.prop("tagName")){var d=t.find("option:selected");1===d.length?n=t.find("option:selected").val():d.length>1&&(n=e.map(t.find("option:selected"),function(e,t){return $(e).val()}))}else n=t.val();if("undefined"!=typeof t.data("panels-filter"))switch(t.data("panels-filter")){case"json_parse":try{n=JSON.parse(n)}catch(h){n=""}}if(null!==n)for(var c=0;c<l.length;c++)c===l.length-1?o[l[c]]=n:("undefined"==typeof o[l[c]]&&(o[l[c]]={}),o=o[l[c]])}),s},setStatusMessage:function(e,t){this.$(".so-toolbar .so-status").html(e),"undefined"!=typeof t&&t&&this.$(".so-toolbar .so-status").addClass("so-panels-loading")},setParent:function(e,t){this.parentDialog={text:e,dialog:t}}}),i.dialog.builder=i.view.dialog.extend({dialogClass:"so-panels-dialog-add-builder",render:function(){this.renderDialog(this.parseDialogContent($("#siteorigin-panels-dialog-builder").html(),{})),this.$(".so-content .siteorigin-panels-builder").append(this.builder.$el)},initializeDialog:function(){var e=this;this.once("open_dialog_complete",function(){e.builder.initSortable()}),this.on("open_dialog_complete",function(){e.builder.trigger("builder_resize")})}}),i.dialog.widgets=i.view.dialog.extend({builder:null,widgetTemplate:e.template($("#siteorigin-panels-dialog-widgets-widget").html().panelsProcessTemplate()),filter:{},dialogClass:"so-panels-dialog-add-widget",events:{"click .so-close":"closeDialog","click .widget-type":"widgetClickHandler","keyup .so-sidebar-search":"searchHandler"},initializeDialog:function(){this.on("open_dialog",function(){this.filter.search="",this.filterWidgets(this.filter)},this),this.on("open_dialog_complete",function(){this.$(".so-sidebar-search").val("").focus()}),this.on("tab_click",this.tabClickHandler,this)},render:function(){this.renderDialog(this.parseDialogContent($("#siteorigin-panels-dialog-widgets").html(),{})),e.each(t.widgets,function(e){var t=$(this.widgetTemplate({title:e.title,description:e.description}));"undefined"==typeof e.icon&&(e.icon="dashicons dashicons-admin-generic"),"undefined"!=typeof e.icon&&$('<span class="widget-icon" />').addClass(e.icon).prependTo(t.find(".widget-type-wrapper")),t.data("class",e.class).appendTo(this.$el.find(".widget-type-list"))},this);var i=this.$el.find(".so-sidebar-tabs");e.each(t.widget_dialog_tabs,function(e){var t=$(this.dialogTabTemplate({title:e.title})).data("filter",e.filter).appendTo(i)},this),this.initTabs()},tabClickHandler:function(e){return this.filter=e.parent().data("filter"),""!==this.$el.find(".so-sidebar-search").val()&&(this.filter.search=this.$el.find(".so-sidebar-search").val()),this.filterWidgets(this.filter),!1},searchHandler:function(e){this.filter.search=$(e.target).val(),this.filterWidgets(this.filter)},filterWidgets:function(i){"undefined"==typeof i&&(i={}),"undefined"==typeof i.groups&&(i.groups=""),this.$el.find(".widget-type-list .widget-type").each(function(){var s=$(this),l,o=s.data("class"),n="undefined"!=typeof t.widgets[o]?t.widgets[o]:null;l=0===i.groups.length?!0:null!==n&&e.intersection(i.groups,t.widgets[o].groups).length?!0:!1,l&&"undefined"!=typeof i.search&&""!==i.search&&-1===n.title.toLowerCase().indexOf(i.search.toLowerCase())&&(l=!1),l?s.show():s.hide()})},widgetClickHandler:function(e){this.builder.addHistoryEntry("widget_added");var t=$(e.currentTarget),s=new i.model.widget({"class":t.data("class")});s.cell=this.builder.getActiveCell(),s.cell.widgets.add(s),this.closeDialog()}}),i.dialog.widget=i.view.dialog.extend({builder:null,sidebarWidgetTemplate:e.template($("#siteorigin-panels-dialog-widget-sidebar-widget").html().panelsProcessTemplate()),dialogClass:"so-panels-dialog-edit-widget",widgetView:!1,events:{"click .so-close":"saveHistory","click .so-nav.so-previous":"navToPrevious","click .so-nav.so-next":"navToNext","click .so-toolbar .so-delete":"deleteHandler","click .so-toolbar .so-duplicate":"duplicateHandler"},initializeDialog:function(){this.model.on("destroy",this.remove,this)},render:function(){this.renderDialog(this.parseDialogContent($("#siteorigin-panels-dialog-widget").html(),{})),this.loadForm(),this.$(".so-title .widget-name").html("undefined"!=typeof t.widgets[this.model.get("class")]?t.widgets[this.model.get("class")].title:t.loc.missing_widget.title),this.styles=new i.view.styles,this.styles.model=this.model,this.styles.render("widget"),this.styles.attach(this.$(".so-sidebar.so-right-sidebar")),this.styles.on("styles_loaded",function(){this.$(".so-sidebar.so-right-sidebar").removeClass("so-panels-loading")},this),this.$(".so-sidebar.so-right-sidebar").addClass("so-panels-loading")},getPrevDialog:function(){var e=this.builder.$(".so-cells .cell .so-widget");if(e.length<=1)return!1;var t=e.index(this.widgetView.$el);if(0===t)return!1;var i=e.eq(t-1).data("view");return"undefined"==typeof i?!1:i.getEditDialog()},getNextDialog:function(){var e=this.builder.$(".so-cells .cell .so-widget");if(e.length<=1)return!1;var t=e.index(this.widgetView.$el);if(t===e.length-1)return!1;var i=e.eq(t+1).data("view");return"undefined"==typeof i?!1:i.getEditDialog()},loadForm:function(){var e=this;this.$el.find(".so-content").addClass("so-panels-loading");var t={action:"so_panels_widget_form",widget:this.model.get("class"),instance:JSON.stringify(this.model.get("values")),raw:this.model.get("raw")};$.post(ajaxurl,t,function(t){var i=t.replace(/{\$id}/g,e.model.cid);e.$el.find(".so-content").removeClass("so-panels-loading").html(i),e.trigger("form_loaded",e),e.$el.find(".panel-dialog").trigger("panelsopen"),e.on("close_dialog",e.saveWidget,e)},"html")},saveWidget:function(){var e=this.getFormValues();if("undefined"==typeof e.widgets)return!1;if(e=e.widgets,e=e[Object.keys(e)[0]],this.model.setValues(e),this.model.set("raw",!0),this.styles.stylesLoaded){var t={};try{t=this.getFormValues(".so-sidebar .so-visual-styles").style
}catch(i){}this.model.set("style",t)}},saveHistory:function(){this.builder.addHistoryEntry("widget_edited"),this.closeDialog()},deleteHandler:function(){return this.builder.liveEditor.displayed?(this.model.destroy(),this.builder.liveEditor.refreshWidgets()):this.model.trigger("visual_destroy"),this.closeDialog(),!1},duplicateHandler:function(){return this.model.trigger("user_duplicate"),this.builder.liveEditor.displayed&&this.builder.liveEditor.refreshWidgets(),this.closeDialog(),!1}}),i.dialog.prebuilt=i.view.dialog.extend({entryTemplate:e.template($("#siteorigin-panels-dialog-prebuilt-entry").html().panelsProcessTemplate()),builder:null,dialogClass:"so-panels-dialog-prebuilt-layouts",layoutCache:{},currentTab:!1,events:{"click .so-close":"closeDialog","click .so-sidebar-tabs li a":"tabClickHandler","click .so-content .layout":"layoutClickHandler","keyup .so-sidebar-search":"searchHandler"},initializeDialog:function(){var e=this;this.on("open_dialog",function(){e.$('.so-sidebar-tabs li a[href="#prebuilt"]').click(),e.$(".so-status").removeClass("so-panels-loading")})},render:function(){this.renderDialog(this.parseDialogContent($("#siteorigin-panels-dialog-prebuilt").html(),{}))},tabClickHandler:function(e){this.$(".so-sidebar-tabs li").removeClass("tab-active");var t=$(e.target),i=t.attr("href").split("#")[1];t.parent().addClass("tab-active");var s=this;return this.$(".so-content").empty(),this.currentTab=i,"undefined"==typeof this.layoutCache[i]?(this.$(".so-content").addClass("so-panels-loading"),$.post(ajaxurl,{action:"so_panels_prebuilt_layouts",type:i},function(e){s.layoutCache[i]=e,s.$(".so-content").removeClass("so-panels-loading"),s.displayLayouts(i,e)})):s.displayLayouts(i,this.layoutCache[i]),!1},displayLayouts:function(e,t){var i=this.$(".so-content").empty(),s=this.$(".so-sidebar-search").val().toLowerCase();if("undefined"!=typeof t.error_message)return void this.$(".so-content").append($('<div class="so-error-message">').html(t.error_message));for(var l in t)if(!("prebuilt"!==e&&l===$("#post_ID").val()||""!==s&&-1===t[l].name.toLowerCase().indexOf(s))){var o=$(this.entryTemplate({name:t[l].name,description:t[l].description}));o.appendTo(i).data({type:e,lid:l})}},layoutClickHandler:function(e){var t=$(e.target).closest(".layout");return this.loadLayout(t.data("type"),t.data("lid")),!1},loadLayout:function(e,i){var s=this;return confirm(t.loc.prebuilt_confirm)?(this.setStatusMessage(t.loc.prebuilt_loading,!0),void $.post(ajaxurl,{action:"so_panels_get_prebuilt_layout",type:e,lid:i},function(e){s.setStatusMessage("",!1),s.builder.addHistoryEntry("prebuilt_loaded"),s.builder.model.loadPanelsData(e),s.closeDialog()})):!1},searchHandler:function(){return this.currentTab===!1||"undefined"==typeof this.layoutCache[this.currentTab]?!1:void this.displayLayouts(this.currentTab,this.layoutCache[this.currentTab])}}),i.dialog.row=i.view.dialog.extend({cellPreviewTemplate:e.template($("#siteorigin-panels-dialog-row-cell-preview").html().panelsProcessTemplate()),events:{"click .so-close":"closeDialog","click .so-toolbar .so-save":"saveHandler","click .so-toolbar .so-insert":"insertHandler","click .so-toolbar .so-delete":"deleteHandler","click .so-toolbar .so-duplicate":"duplicateHandler","change .row-set-form > *":"setCellsFromForm","click .row-set-form button.set-row":"setCellsFromForm"},dialogClass:"so-panels-dialog-row-edit",styleType:"row",dialogType:"edit",row:{cells:[],style:{}},initializeDialog:function(){this.on("open_dialog",function(){this.setRowModel("undefined"!=typeof this.model&&0!==this.model.cells.length?this.model:null),this.regenerateRowPreview()},this),this.row={cells:[.5,.5],style:{}}},setRowDialogType:function(e){this.dialogType=e},render:function(e){this.renderDialog(this.parseDialogContent($("#siteorigin-panels-dialog-row").html(),{dialogType:this.dialogType})),"edit"===this.dialogType&&(this.styles=new i.view.styles,this.styles.model=this.model,this.styles.render("row"),this.styles.attach(this.$(".so-sidebar.so-right-sidebar")),this.styles.on("styles_loaded",function(){this.$(".so-sidebar.so-right-sidebar").removeClass("so-panels-loading")},this),this.$(".so-sidebar.so-right-sidebar").addClass("so-panels-loading")),"undefined"!=typeof this.model&&this.$("input.so-row-field").val(this.model.cells.length);var t=this;return this.$("input.so-row-field").keyup(function(){$(this).trigger("change")}),this},setRowModel:function(e){return this.model=e,null===this.model?this:(this.row={cells:this.model.cells.map(function(e){return e.get("weight")}),style:{}},this.$("input.so-row-field").val(this.model.cells.length),this)},regenerateRowPreview:function(){var t=this,i=this.$(".row-preview");i.empty();var s;e.each(this.row.cells,function(l,o){var n=$(this.cellPreviewTemplate({weight:l}));i.append(n);var a=n.prev(),r;0!==a.length&&(r=$('<div class="resize-handle"></div>'),r.appendTo(n).dblclick(function(){var e=t.row.cells[o]+t.row.cells[o-1];t.row.cells[o]=t.row.cells[o-1]=e/2,t.scaleRowWidths()}),r.draggable({axis:"x",containment:i,start:function(e,t){var i=n.clone().appendTo(t.helper).css({position:"absolute",top:"0",width:n.outerWidth(),left:6,height:n.outerHeight()});i.find(".resize-handle").remove();var s=a.clone().appendTo(t.helper).css({position:"absolute",top:"0",width:a.outerWidth(),right:6,height:a.outerHeight()});s.find(".resize-handle").remove(),$(this).data({newCellClone:i,prevCellClone:s}),n.find("> .preview-cell-in").css("visibility","hidden"),a.find("> .preview-cell-in").css("visibility","hidden")},drag:function(e,s){var l=t.row.cells[o]-(s.position.left+6)/i.width(),n=t.row.cells[o-1]+(s.position.left+6)/i.width(),a=s.helper.offset().left-i.offset().left-6;$(this).data("newCellClone").css("width",i.width()*l).find(".preview-cell-weight").html(Math.round(1e3*l)/10),$(this).data("prevCellClone").css("width",i.width()*n).find(".preview-cell-weight").html(Math.round(1e3*n)/10)},stop:function(e,s){$(this).data("newCellClone").remove(),$(this).data("prevCellClone").remove(),n.find(".preview-cell-in").css("visibility","visible"),a.find(".preview-cell-in").css("visibility","visible");var l=s.position.left+6,r=l/i.width();t.row.cells[o]-r>.02&&t.row.cells[o-1]+r>.02&&(t.row.cells[o]-=r,t.row.cells[o-1]+=r),t.scaleRowWidths(),s.helper.css("left",-6)}})),n.find(".preview-cell-weight").click(function(l){t.$(".resize-handle").css("pointer-event","none").draggable("disable"),i.find(".preview-cell-weight").each(function(){var l=$(this).hide();$('<input type="text" class="preview-cell-weight-input no-user-interacted" />').val(parseFloat(l.html())).insertAfter(l).focus(function(){clearTimeout(s)}).keyup(function(e){9!==e.keyCode&&$(this).removeClass("no-user-interacted"),13===e.keyCode&&(e.preventDefault(),$(this).blur())}).keydown(function(e){if(9===e.keyCode){e.preventDefault();var t=i.find(".preview-cell-weight-input"),s=t.index($(this));s===t.length-1?t.eq(0).focus().select():t.eq(s+1).focus().select()}}).blur(function(){i.find(".preview-cell-weight-input").each(function(e,i){isNaN(parseFloat($(i).val()))&&$(i).val(Math.floor(1e3*t.row.cells[e])/10)}),s=setTimeout(function(){if(0===i.find(".preview-cell-weight-input").length)return!1;var s=[],l=[],o=0,n=0;if(i.find(".preview-cell-weight-input").each(function(e,i){var a=parseFloat($(i).val());a=isNaN(a)?1/t.row.cells.length:Math.round(10*a)/1e3;var r=!$(i).hasClass("no-user-interacted");s.push(a),l.push(r),r?o+=a:n+=a}),o>0&&n>0&&1-o>0)for(var a=0;a<s.length;a++)l[a]||(s[a]=s[a]/n*(1-o));var r=e.reduce(s,function(e,t){return e+t});s=s.map(function(e){return e/r}),Math.min.apply(Math,s)>.01&&(t.row.cells=s),i.find(".preview-cell").each(function(e,i){$(i).animate({width:Math.round(1e3*t.row.cells[e])/10+"%"},250),$(i).find(".preview-cell-weight-input").val(Math.round(1e3*t.row.cells[e])/10)}),i.find(".preview-cell").css("overflow","visible"),setTimeout(function(){t.regenerateRowPreview()},260)},100)}).click(function(){$(this).select()})}),$(this).siblings(".preview-cell-weight-input").select()})},this)},scaleRowWidths:function(){var e=this;this.$(".row-preview .preview-cell").each(function(t,i){$(i).css("width",100*e.row.cells[t]+"%").find(".preview-cell-weight").html(Math.round(1e3*e.row.cells[t])/10)})},setCellsFromForm:function(){var t={cells:parseInt(this.$el.find('.row-set-form input[name="cells"]').val()),ratio:parseFloat(this.$el.find('.row-set-form select[name="ratio"]').val()),direction:this.$el.find('.row-set-form select[name="ratio_direction"]').val()},i=[];if(isNaN(t.cells)||isNaN(t.ratio))return!1;var s=this.row.cells.length!==t.cells;t.cells<1?(this.$el.find('.row-set-form input[name="cells"]').val(1),t.cells=1):t.cells>20&&(this.$el.find('.row-set-form input[name="cells"]').val(20),t.cells=20);for(var l=1,o=0;o<t.cells;o++)i.push(l),l*=t.ratio;var n=e.reduce(i,function(e,t){return e+t});if(i=e.map(i,function(e){return e/n}),i=e.filter(i,function(e){return e>.01}),"left"===t.direction&&(i=i.reverse()),this.row.cells=i,s)this.regenerateRowPreview();else{var a=this;this.$el.find(".preview-cell").each(function(e,t){$(t).animate({width:Math.round(1e3*a.row.cells[e])/10+"%"},250),$(t).find(".preview-cell-weight").html(Math.round(1e3*a.row.cells[e])/10)}),this.$el.find(".preview-cell").css("overflow","visible"),setTimeout(function(){a.regenerateRowPreview()},260)}this.$el.find(".row-set-form .so-button-row-set").removeClass("button-primary")},tabClickHandler:function(e){"#row-layout"===e.attr("href")?this.$(".so-panels-dialog").addClass("so-panels-dialog-has-right-sidebar"):this.$(".so-panels-dialog").removeClass("so-panels-dialog-has-right-sidebar")},updateModel:function(){if(this.model.setCells(this.row.cells),"undefined"!=typeof this.styles&&this.styles.stylesLoaded){var e={};try{e=this.getFormValues(".so-sidebar .so-visual-styles").style}catch(t){}this.model.set("style",e)}},insertHandler:function(){return this.builder.addHistoryEntry("row_added"),this.model=new i.model.row,this.updateModel(),this.model.collection=this.builder.model.rows,this.builder.model.rows.add(this.model),this.closeDialog(),!1},saveHandler:function(){return this.builder.addHistoryEntry("row_edited"),this.updateModel(),this.closeDialog(),!1},deleteHandler:function(){return this.model.trigger("visual_destroy"),this.closeDialog(),!1},duplicateHandler:function(){this.builder.addHistoryEntry("row_duplicated");var e=this.model.clone(this.builder.model);return this.builder.model.rows.add(e,{at:this.builder.model.rows.indexOf(this.model)+1}),this.closeDialog(),!1}}),window.siteoriginPanels=i}(jQuery,_,soPanelsOptions),jQuery(function($){var e=!1,t=!1,i=!1,s=!1;if($("#siteorigin-panels-metabox").length&&$("form#post").length)e=$("#siteorigin-panels-metabox"),t=$("#siteorigin-panels-metabox .siteorigin-panels-data-field"),i=$("form#post"),s=$("#post_ID").val();else if($("div#panels-home-page.wrap").length){var l=$("div#panels-home-page.wrap");e=l.find(".siteorigin-panels-builder"),t=l.find('input[name="panels_data"]'),i=l.find("form"),s=$("#panels-home-page").data("post-id")}if(e!==!1){var o=window.siteoriginPanels,n=new o.model.builder,a=new o.view.builder({model:n});a.render().attach({container:e}).setDataField(t).attachToEditor().addLiveEditor(s).addHistoryBrowser(),i.submit(function(e){n.refreshPanelsData()}),e.removeClass("so-panels-loading")}}),function($){var e=window.siteoriginPanels;$.fn.soPanelsSetupBuilderWidget=function(){return this.each(function(){var t=$(this),i=t.closest("form").find(".widget-id").val();if(!("undefined"!=typeof i&&i.indexOf("__i__")>-1)){var s=new e.model.builder,l=new e.view.builder({model:s}),o=t.closest(".so-panels-dialog-wrapper").data("view");"undefined"!=typeof o&&(o.on("close_dialog",function(){s.refreshPanelsData()}),o.on("open_dialog_complete",function(){l.trigger("builder_resize")}),o.model.on("destroy",function(){s.emptyRows().destroy()}),l.setDialogParents(soPanelsOptions.loc.layout_widget,o));var n=Boolean(t.closest(".widget-content").length);l.render().attach({container:t,dialog:n}).setDataField(t.find("input.panels-data")),n?(l.setDialogParents(soPanelsOptions.loc.layout_widget,l.dialog),t.find(".siteorigin-panels-display-builder").click(function(){l.dialog.openDialog()})):t.find(".siteorigin-panels-display-builder").parent().remove()}})},$(document).on("widget-added",function(e,t){$(t).find(".siteorigin-page-builder-widget").soPanelsSetupBuilderWidget()}),$(function(){$(".siteorigin-page-builder-widget").soPanelsSetupBuilderWidget()})}(jQuery);